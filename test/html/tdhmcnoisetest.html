
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Test HMC integration over nuisance parameters to obtain noise parameters</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-10-27"><meta name="DC.source" content="tdhmcnoisetest.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Test HMC integration over nuisance parameters to obtain noise parameters</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Set initial parameters</a></li><li><a href="#2">Simulate data</a></li><li><a href="#3">Define prior distribution</a></li><li><a href="#4">Define log posterior</a></li><li><a href="#5">Create HMC sampler</a></li><li><a href="#6">Estimate MAP point</a></li><li><a href="#7">Tune sampler</a></li><li><a href="#8">Draw samples</a></li><li><a href="#9">Examine convergence diagnostics</a></li><li><a href="#10">Visualize samples</a></li></ul></div><h2 id="1">Set initial parameters</h2><pre class="codeinput">T=.05;          <span class="comment">% sampling time [ps]</span>
N=256;          <span class="comment">% number of sampled points</span>
M=10;           <span class="comment">% number of traces to compare</span>
SNR=2e3;        <span class="comment">% signal to noise ratio</span>
w=0.2;          <span class="comment">% pulse width [ps]</span>
tc=N*T/3;       <span class="comment">% pulse center [ps]</span>
nMC = pow2(10); <span class="comment">% number of Monte Carlo runs</span>

<span class="comment">% Generate ideal time-domain pulse and pulse derivative</span>
t=T*(0:N-1);
t=t(:);

xfun = @(t,t0,w) (1-2*((t-t0)/w).^2).*exp(-((t-t0)/w).^2);
</pre><h2 id="2">Simulate data</h2><pre class="codeinput">Noise.add = 1/SNR;
Noise.mult = 10/SNR;
Noise.time = 10*T/SNR;
sigma_alpha = Noise.add;
sigma_beta = Noise.mult;
sigma_tau = Noise.time;

rng(<span class="string">'default'</span>)
epsilon_alpha = sigma_alpha*randn(N,M);
epsilon_beta = sigma_beta*randn(N,M);
epsilon_tau = sigma_tau*randn(N,M);

sigma_A = 0.05;
sigma_eta = 0.1*T;

x = zeros(N,M);
A = 1 + [0; sigma_A*randn(M-1,1)];
eta = [0; sigma_eta*randn(M-1,1)];
<span class="keyword">for</span> jj = 1:M
    x(:,jj) = A(jj)<span class="keyword">...</span>
        *xfun(t, tc + epsilon_tau(:,jj) + eta(jj), w);
<span class="keyword">end</span>
xn = x + epsilon_alpha + epsilon_beta.*abs(x);
</pre><h2 id="3">Define prior distribution</h2><pre class="codeinput">LogVAlphaPriorMean = -15;
LogVAlphaPriorSigma = 15;
LogVBetaPriorMean = -15;
LogVBetaPriorSigma = 15;
LogVTauPriorMean = -15;
LogVTauPriorSigma = 15;
MuPriorMean = mean(xn, 2);
MuPriorSigma = 10*std(xn, 0, 2);
LogAPriorMean = zeros(M-1,1);
LogAPriorSigma = 5*ones(M-1,1);
EtaPriorMean = zeros(M-1,1);
EtaPriorSigma = 5*T*ones(M-1,1);
</pre><h2 id="4">Define log posterior</h2><pre class="codeinput">logpdf = @(P) tdlogposterior(P, xn, T, <span class="keyword">...</span>
    LogVAlphaPriorMean, LogVAlphaPriorSigma, <span class="keyword">...</span>
    LogVBetaPriorMean, LogVBetaPriorSigma, <span class="keyword">...</span>
    LogVTauPriorMean, LogVTauPriorSigma, <span class="keyword">...</span>
    MuPriorMean, MuPriorSigma, <span class="keyword">...</span>
    LogAPriorMean, LogAPriorSigma, <span class="keyword">...</span>
    EtaPriorMean, EtaPriorSigma);
</pre><h2 id="5">Create HMC sampler</h2><pre class="codeinput">startpoint = [2*log([sigma_alpha; sigma_beta; sigma_tau]); <span class="keyword">...</span>
    xfun(t, tc, w); log(A(2:end)); eta(2:end)];
smp = hmcSampler(logpdf, startpoint, <span class="string">'CheckGradient'</span>, false);
</pre><h2 id="6">Estimate MAP point</h2><pre class="codeinput">[MAPpars,fitInfo] = estimateMAP(smp,<span class="keyword">...</span>
    <span class="string">'VerbosityLevel'</span>, 0, <span class="keyword">...</span>
    <span class="string">'IterationLimit'</span>, 200000);
MAPlogVarAlpha = MAPpars(1);
MAPlogVarBeta = MAPpars(2);
MAPlogVarTau = MAPpars(3);
MAPmu = MAPpars(3 + (1:N));
MAPlogA = MAPpars(3 + N + (1:M-1));
MAPeta = MAPpars(3 + N + M - 1 + (1:M-1));

plot(fitInfo.Iteration,fitInfo.Objective,<span class="string">'ro-'</span>);
xlabel(<span class="string">'Iteration'</span>);
ylabel(<span class="string">'Negative log density'</span>);
</pre><img vspace="5" hspace="5" src="tdhmcnoisetest_01.png" alt=""> <h2 id="7">Tune sampler</h2><pre class="codeinput">[smp,tuneinfo] = tuneSampler(smp, <span class="keyword">...</span>
    <span class="string">'Start'</span>, MAPpars, <span class="keyword">...</span>
    <span class="string">'MassVectorTuningMethod'</span>, <span class="string">'hessian'</span>, <span class="keyword">...</span>
    <span class="string">'VerbosityLevel'</span>, 1, <span class="keyword">...</span>
    <span class="string">'NumPrint'</span>, 10);

disp(smp)
disp(<span class="string">''</span>)

figure;
plot(tuneinfo.StepSizeTuningInfo.StepSizeProfile);
xlabel(<span class="string">'Iteration'</span>);
ylabel(<span class="string">'Step size'</span>);

fprintf(<span class="string">"accratio = %.4f\n"</span>, tuneinfo.StepSizeTuningInfo.AcceptanceRatio)
</pre><pre class="codeoutput">o Tuning mass vector using method: hessian 

o Tuning step size using method: dual-averaging. Target acceptance ratio = 0.65

o Initial step size for dual-averaging = 0.25

|==================================================================================|
|   ITER   |    LOG PDF    |  STEP SIZE  |  NUM STEPS  |  ACC RATIO  |  DIVERGENT  |
|==================================================================================|
|       10 |  1.659744e+04 |   2.562e-01 |          20 |   6.000e-01 |           0 |
|       20 |  1.661242e+04 |   3.992e-01 |          13 |   6.500e-01 |           0 |
|       30 |  1.660793e+04 |   3.565e-01 |          14 |   6.333e-01 |           0 |
|       40 |  1.660293e+04 |   3.347e-01 |          15 |   6.250e-01 |           0 |
|       50 |  1.659718e+04 |   3.726e-01 |          13 |   6.400e-01 |           0 |
|       60 |  1.659250e+04 |   4.069e-01 |          12 |   6.333e-01 |           0 |
|       70 |  1.659831e+04 |   4.097e-01 |          12 |   6.143e-01 |           0 |
|       80 |  1.660361e+04 |   3.933e-01 |          13 |   5.875e-01 |           0 |
|       90 |  1.661385e+04 |   4.087e-01 |          12 |   6.000e-01 |           0 |
|      100 |  1.657758e+04 |   4.138e-01 |          12 |   6.200e-01 |           0 |
  HamiltonianSampler with properties:

                  StepSize: 0.4138
                  NumSteps: 12
                MassVector: [277&times;1 double]
              JitterMethod: 'jitter-both'
      StepSizeTuningMethod: 'dual-averaging'
    MassVectorTuningMethod: 'hessian'
                    LogPDF: [function_handle]
             VariableNames: {277&times;1 cell}
                StartPoint: [277&times;1 double]

accratio = 0.6200
</pre><img vspace="5" hspace="5" src="tdhmcnoisetest_02.png" alt=""> <h2 id="8">Draw samples</h2><pre class="codeinput">NumChains = 4;
chains = cell(NumChains,1);
Burnin = 500;
NumSamples = 1000;
ThinSize = 1;
<span class="keyword">for</span> c = 1:NumChains
    <span class="keyword">if</span> (c == 1)
        level = 1;
    <span class="keyword">else</span>
        level = 0;
    <span class="keyword">end</span>
    chains{c} = drawSamples(smp, <span class="keyword">...</span>
        <span class="string">'Start'</span>, MAPpars, <span class="keyword">...</span>
        <span class="string">'Burnin'</span>, Burnin, <span class="keyword">...</span>
        <span class="string">'NumSamples'</span>, NumSamples, <span class="keyword">...</span>
        <span class="string">'ThinSize'</span>, ThinSize, <span class="keyword">...</span>
        <span class="string">'VerbosityLevel'</span>, level, <span class="keyword">...</span>
        <span class="string">'NumPrint'</span>, 100);
<span class="keyword">end</span>
</pre><pre class="codeoutput">

|==================================================================================|
|   ITER   |    LOG PDF    |  STEP SIZE  |  NUM STEPS  |  ACC RATIO  |  DIVERGENT  |
|==================================================================================|
|      100 |  1.659739e+04 |   3.724e-01 |           3 |   8.700e-01 |           0 |
|      200 |  1.657552e+04 |   1.163e-01 |           7 |   9.000e-01 |           0 |
|      300 |  1.658624e+04 |   3.724e-01 |           8 |   9.067e-01 |           0 |
|      400 |  1.658719e+04 |   3.645e-02 |           3 |   9.100e-01 |           0 |
|      500 |  1.660492e+04 |   3.724e-01 |           7 |   8.920e-01 |           0 |
|      600 |  1.657420e+04 |   3.724e-01 |           1 |   8.833e-01 |           0 |
|      700 |  1.658826e+04 |   1.432e-01 |           3 |   8.843e-01 |           0 |
|      800 |  1.659961e+04 |   3.366e-01 |           6 |   8.862e-01 |           0 |
|      900 |  1.658240e+04 |   1.984e-02 |          11 |   8.856e-01 |           0 |
|     1000 |  1.657399e+04 |   3.724e-01 |          11 |   8.880e-01 |           0 |
|     1100 |  1.659070e+04 |   2.997e-01 |           5 |   8.891e-01 |           0 |
|     1200 |  1.658398e+04 |   3.724e-01 |           5 |   8.908e-01 |           0 |
|     1300 |  1.657987e+04 |   3.724e-01 |          11 |   8.923e-01 |           0 |
|     1400 |  1.659717e+04 |   3.724e-01 |           1 |   8.950e-01 |           0 |
|     1500 |  1.660814e+04 |   1.717e-01 |           9 |   8.993e-01 |           0 |
</pre><h2 id="9">Examine convergence diagnostics</h2><pre class="codeinput">diags = diagnostics(smp,chains);
disp(diags)

concatenatedSamples = vertcat(chains{:});
true_sigma = [sigma_alpha, sigma_beta, sigma_tau];
mean_exp = sqrt(mean(exp(concatenatedSamples(:,1:3))));
exp_mean = sqrt(exp(mean(concatenatedSamples(:,1:3))));
sigmaEst = [true_sigma; mean_exp; exp_mean]';

fprintf(<span class="string">"%-15s%15s%15s%15s\n"</span>, <span class="string">"Parameter"</span>, <span class="string">"True"</span>, <span class="string">"&lt;exp(logv)&gt;"</span>, <span class="string">"exp(&lt;logv&gt;)"</span>)
fprintf(<span class="string">"%-15s%15.4e%15.4e%15.4e\n"</span>, <span class="string">"sigma_alpha"</span>, sigmaEst(1,:))
fprintf(<span class="string">"%-15s%15.4e%15.4e%15.4e\n"</span>, <span class="string">"sigma_beta"</span>, sigmaEst(2,:))
fprintf(<span class="string">"%-15s%15.4e%15.4e%15.4e\n"</span>, <span class="string">"sigma_tau"</span>, sigmaEst(3,:))
</pre><pre class="codeoutput">      Name         Mean           MCSE           SD            Q5             Q95         ESS       RHat 
    ________    ___________    __________    __________    ___________    ___________    ______    ______

    {'x1'  }        -15.189    0.00062283       0.03065        -15.239        -15.138    2421.8         1
    {'x2'  }        -10.689     0.0051948       0.20391         -11.04        -10.361    1540.8    1.0002
    {'x3'  }        -16.836      0.012106       0.43457        -17.562        -16.166    1288.6         1
    {'x4'  }     0.00028206    2.8762e-06    0.00015824     1.9192e-05     0.00053892      3027    1.0006
    {'x5'  }     0.00016658    2.8932e-06    0.00015955    -9.4448e-05     0.00043384    3041.1    1.0002
    {'x6'  }     0.00017121    2.8845e-06    0.00016276    -9.8257e-05     0.00043987      3184         1
    {'x7'  }      2.196e-05    2.6607e-06     0.0001525    -0.00023013     0.00026714      3285    1.0002
    {'x8'  }     8.8813e-05    2.7141e-06    0.00015283     -0.0001611      0.0003425    3170.9         1
    {'x9'  }     -5.331e-05    2.8989e-06    0.00016232    -0.00032416     0.00021853    3135.2    1.0001
    {'x10' }    -2.4123e-06     3.003e-06    0.00016043    -0.00026527     0.00026983      2854         1
    {'x11' }      0.0001832    2.8854e-06    0.00016316    -8.6257e-05     0.00045765    3197.8    1.0005
    {'x12' }    -3.1436e-05    2.6908e-06    0.00015217    -0.00027477     0.00021394    3198.1         1
    {'x13' }     7.2318e-05    3.1702e-06    0.00016747    -0.00019996     0.00035446    2790.5    1.0001
    {'x14' }     0.00010756    2.9441e-06     0.0001571    -0.00015838     0.00036831    2847.4    1.0002
    {'x15' }     0.00013419    2.7629e-06     0.0001598    -0.00013563     0.00039603    3345.1    1.0005
    {'x16' }      0.0003472     2.801e-06    0.00015955      7.633e-05     0.00061321    3244.5         1
    {'x17' }     0.00013321    2.7991e-06    0.00016344    -0.00013357     0.00040168    3409.5    1.0008
    {'x18' }     0.00025455    2.8008e-06    0.00015495    -2.1509e-06     0.00050685    3060.8    1.0001
    {'x19' }      7.388e-05    2.9293e-06    0.00015528    -0.00019181     0.00033428    2810.1    1.0007
    {'x20' }     6.8764e-05    2.9461e-06    0.00015902    -0.00019085     0.00033526    2913.5    1.0011
    {'x21' }     0.00021666     2.937e-06    0.00016501    -4.7962e-05     0.00049146    3156.7         1
    {'x22' }    -6.6392e-06    2.8487e-06    0.00016002    -0.00027657     0.00025807    3155.4    1.0004
    {'x23' }     -0.0001319    2.9722e-06    0.00015977    -0.00039697     0.00012847    2889.7         1
    {'x24' }      8.303e-05    2.7267e-06    0.00015328    -0.00017249     0.00033441    3160.2    1.0002
    {'x25' }     -0.0003168    2.8319e-06    0.00015664    -0.00056804    -5.8218e-05    3059.4    1.0006
    {'x26' }    -0.00012521    2.9346e-06     0.0001574    -0.00038159     0.00013777    2876.8         1
    {'x27' }     0.00026313    2.7029e-06    0.00015429     6.8984e-06     0.00051498    3258.5    1.0003
    {'x28' }    -3.3762e-05    2.9642e-06    0.00016589    -0.00030488     0.00023698    3131.9         1
    {'x29' }     7.8924e-05    3.0812e-06    0.00016516    -0.00018358     0.00035041    2873.3         1
    {'x30' }     0.00012843      2.97e-06    0.00016864    -0.00014646     0.00040367    3224.2         1
    {'x31' }    -1.7528e-05    2.9125e-06    0.00015748    -0.00027669     0.00024552    2923.6         1
    {'x32' }     3.6388e-05    2.6467e-06    0.00015209    -0.00021249     0.00028832    3301.9         1
    {'x33' }     3.4383e-06    3.0138e-06    0.00015978    -0.00025616     0.00026172    2810.9    1.0012
    {'x34' }    -8.5948e-06    2.8224e-06    0.00016301    -0.00027418     0.00025915    3335.7         1
    {'x35' }     8.5928e-05    2.7292e-06    0.00015685    -0.00017799     0.00034162    3302.9         1
    {'x36' }     1.6717e-05    2.9298e-06    0.00015948     -0.0002414     0.00028555    2962.9    1.0001
    {'x37' }    -0.00010485    2.8517e-06    0.00015819    -0.00036707     0.00014673    3077.4    1.0022
    {'x38' }    -0.00012417    2.7112e-06    0.00015908    -0.00038988     0.00013983    3442.6         1
    {'x39' }     2.9281e-05    2.9507e-06    0.00016735    -0.00023432     0.00030049    3216.9         1
    {'x40' }    -0.00020317    2.7893e-06    0.00015724      -0.000466     5.3642e-05      3178         1
    {'x41' }     6.7469e-05    3.0147e-06    0.00015709    -0.00018682       0.000323    2715.2         1
    {'x42' }     0.00013204    2.8801e-06    0.00015586    -0.00012452     0.00038318    2928.5    1.0002
    {'x43' }    -7.9494e-05    2.8408e-06    0.00015688    -0.00033797     0.00018059    3049.7    1.0002
    {'x44' }     3.4479e-05    2.7779e-06    0.00016111    -0.00022196     0.00029498    3363.5         1
    {'x45' }    -0.00014355    2.7777e-06    0.00016112    -0.00041197     0.00012063    3364.7    1.0003
    {'x46' }    -8.9901e-06    2.9661e-06    0.00016227    -0.00027524     0.00025399    2992.9    1.0002
    {'x47' }    -0.00025025      2.96e-06    0.00015768     -0.0005111     5.9971e-06    2837.8         1
    {'x48' }    -0.00010857    2.9989e-06    0.00015748    -0.00035868     0.00015881    2757.4    1.0008
    {'x49' }    -7.5968e-05    2.8819e-06    0.00016365    -0.00034756     0.00019665    3224.5         1
    {'x50' }     5.0235e-05    2.9602e-06    0.00016254     -0.0002087     0.00031537    3014.8    1.0007
    {'x51' }     4.5051e-05    2.8135e-06    0.00015594    -0.00021914     0.00029726    3071.8     1.001
    {'x52' }     0.00021221    2.9174e-06    0.00015962    -5.1248e-05     0.00047276    2993.5         1
    {'x53' }    -4.1891e-05    3.0328e-06    0.00016812    -0.00031876     0.00023413    3073.1         1
    {'x54' }     8.0473e-05    2.8542e-06    0.00016039     -0.0001758     0.00035123    3157.8         1
    {'x55' }     -3.675e-05     3.019e-06    0.00016033    -0.00029923     0.00022426    2820.5    1.0002
    {'x56' }    -8.5668e-05     2.917e-06    0.00015938    -0.00034824     0.00017917    2985.3    1.0006
    {'x57' }    -0.00013279    2.8537e-06    0.00015971    -0.00040196      0.0001263    3132.1         1
    {'x58' }       5.21e-05    2.8048e-06    0.00015884    -0.00020705     0.00032414    3207.1    1.0001
    {'x59' }     0.00011511    2.5526e-06    0.00015407    -0.00013512     0.00036979    3643.2         1
    {'x60' }    -0.00022125    2.8675e-06    0.00016261    -0.00048546     4.7745e-05    3215.6    1.0005
    {'x61' }    -6.5836e-05    2.9611e-06    0.00016604    -0.00034475     0.00020041    3144.5    1.0003
    {'x62' }    -0.00018913    2.9764e-06    0.00016112    -0.00046054     8.4293e-05    2930.5    1.0005
    {'x63' }     4.9119e-05     2.739e-06     0.0001514    -0.00019774     0.00029798    3055.3    1.0006
    {'x64' }    -0.00035103    2.8851e-06    0.00015928    -0.00061141    -9.1013e-05    3047.7    1.0007
    {'x65' }     0.00014546    2.8941e-06    0.00015992    -0.00011826     0.00040248    3053.2         1
    {'x66' }     0.00013902    2.9349e-06     0.0001647    -0.00012556     0.00041268    3149.2         1
    {'x67' }     4.3243e-05    2.6862e-06    0.00015356    -0.00020836     0.00030106      3268         1
    {'x68' }    -0.00015153      2.97e-06    0.00016021    -0.00041858     0.00011507    2909.8         1
    {'x69' }     -2.958e-05    2.7368e-06    0.00015661     -0.0002814     0.00022737    3274.4         1
    {'x70' }     -1.283e-05    2.9317e-06    0.00016611    -0.00028923     0.00026556    3210.2         1
    {'x71' }     9.9277e-05    2.8685e-06     0.0001574    -0.00016521     0.00034853    3010.9         1
    {'x72' }    -5.1701e-05    2.9612e-06    0.00016794    -0.00032686     0.00022024    3216.5    1.0005
    {'x73' }     0.00013739    2.9064e-06    0.00015966    -0.00013296     0.00039861    3017.8    1.0001
    {'x74' }    -0.00020642    2.8199e-06    0.00015774    -0.00046134       5.17e-05    3129.1    1.0007
    {'x75' }    -0.00014766    2.9362e-06    0.00016126    -0.00040767     0.00012112    3016.4    1.0003
    {'x76' }    -0.00049888    2.9393e-06    0.00016261    -0.00076131    -0.00023297    3060.8    1.0008
    {'x77' }     -0.0014492    2.8297e-06    0.00016286      -0.001718     -0.0011759    3312.3         1
    {'x78' }     -0.0048839    2.8431e-06    0.00016225     -0.0051464     -0.0046086    3256.7         1
    {'x79' }      -0.015711    3.9817e-06    0.00017426      -0.015998      -0.015415    1915.4         1
    {'x80' }      -0.042957    7.0295e-06    0.00020655      -0.043315      -0.042624    863.42    1.0011
    {'x81' }       -0.10063    1.2831e-05    0.00032058       -0.10116       -0.10009    624.23         1
    {'x82' }       -0.19924    2.4618e-05    0.00052597       -0.20013       -0.19839    456.48    1.0021
    {'x83' }       -0.32782    3.7659e-05    0.00075259       -0.32905       -0.32658    399.36    1.0017
    {'x84' }       -0.43082    4.3295e-05    0.00089648       -0.43227       -0.42934    428.76    1.0029
    {'x85' }       -0.41674    4.7348e-05    0.00090663       -0.41823       -0.41529    366.66    1.0007
    {'x86' }       -0.19579    4.6451e-05    0.00089895        -0.1973       -0.19429    374.52    1.0029
    {'x87' }        0.22794    6.3777e-05     0.0012603        0.22591        0.23004    390.52    1.0028
    {'x88' }        0.69788    8.4336e-05     0.0017089         0.6951        0.70072    410.61     1.001
    {'x89' }         0.9816    0.00010709     0.0019668        0.97837        0.98474    337.33    1.0043
    {'x90' }        0.91981    0.00010689     0.0019318        0.91655        0.92287    326.61     1.003
    {'x91' }        0.54945    8.1598e-05     0.0015676        0.54693        0.55209    369.05    1.0053
    {'x92' }       0.071028    5.5204e-05     0.0011033       0.069224       0.072857    399.47    1.0037
    {'x93' }       -0.29393    4.1991e-05    0.00087789       -0.29538       -0.29251    437.08         1
    {'x94' }       -0.44293    4.3655e-05     0.0009337       -0.44444       -0.44135    457.45    1.0031
    {'x95' }       -0.40575    4.4511e-05    0.00087317       -0.40723       -0.40431    384.83    1.0016
    {'x96' }       -0.28312    3.5723e-05    0.00068499       -0.28426       -0.28201    367.69    1.0039
    {'x97' }       -0.16052    2.2858e-05    0.00045063       -0.16128        -0.1598    388.65    1.0022
    {'x98' }       -0.07692    1.1789e-05     0.0002814      -0.077395      -0.076456    569.79    1.0011
    {'x99' }      -0.031007    5.2044e-06    0.00018764      -0.031328      -0.030709    1299.8    1.0005
    {'x100'}      -0.010931     3.203e-06     0.0001678      -0.011201      -0.010657    2744.4    1.0015
    {'x101'}     -0.0035107    2.9038e-06    0.00015836     -0.0037741     -0.0032542      2974    1.0006
    {'x102'}    -0.00073861    2.9852e-06    0.00016059    -0.00099991    -0.00047625    2893.9    1.0006
    {'x103'}    -0.00042948    2.9606e-06     0.0001647     -0.0007018    -0.00015569    3094.8         1
    {'x104'}     7.5915e-05    2.9259e-06    0.00016492    -0.00019058     0.00035081    3177.1         1
    {'x105'}     8.3057e-05    2.8804e-06    0.00016322     -0.0001891      0.0003506      3211    1.0001
    {'x106'}    -9.2172e-05    2.9204e-06    0.00015992    -0.00035694     0.00016918    2998.7    1.0008
    {'x107'}    -1.8087e-05    2.8842e-06     0.0001579    -0.00028295     0.00024743    2997.1    1.0008
    {'x108'}     0.00013797    2.9974e-06    0.00015795    -0.00012287      0.0003996      2777    1.0003
    {'x109'}    -7.0399e-06    3.2056e-06    0.00017049    -0.00028413     0.00027034    2828.9    1.0007
    {'x110'}     0.00022665    2.7859e-06    0.00015838    -2.7856e-05     0.00050144    3231.7    1.0004
    {'x111'}    -0.00013794    2.8869e-06    0.00016086    -0.00039536      0.0001354    3104.9    1.0003
    {'x112'}     0.00042114    2.8179e-06    0.00016105     0.00015703     0.00067696    3266.5         1
    {'x113'}    -9.5932e-05    2.8988e-06    0.00015945    -0.00035973     0.00017021    3025.6    1.0002
    {'x114'}     7.8366e-05     2.837e-06     0.0001593    -0.00018175     0.00033994    3152.8         1
    {'x115'}    -4.6632e-06    2.9242e-06    0.00016092    -0.00026894     0.00025679    3028.4         1
    {'x116'}      3.447e-05    2.9876e-06     0.0001633    -0.00023347      0.0003051    2987.5    1.0003
    {'x117'}    -0.00013444    3.0514e-06    0.00016211    -0.00040384     0.00012532    2822.6         1
    {'x118'}     0.00016521    2.8074e-06    0.00016196    -0.00010146      0.0004332    3328.3         1
    {'x119'}     4.4366e-05    2.8961e-06    0.00016274    -0.00022125     0.00030992    3157.7         1
    {'x120'}      2.195e-05    3.0767e-06     0.0001684    -0.00024815     0.00029938    2995.8    1.0001
    {'x121'}    -9.3528e-05    3.0484e-06    0.00016179    -0.00036198     0.00016832      2817    1.0006
    {'x122'}     0.00014508    2.7191e-06    0.00015472    -0.00010732     0.00040146    3237.6    1.0002
    {'x123'}    -4.3709e-05     2.755e-06    0.00015958      -0.000302     0.00021797    3355.1         1
    {'x124'}    -0.00022793    2.8871e-06    0.00016158     -0.0004922     3.2117e-05    3132.3         1
    {'x125'}     1.2385e-05     2.971e-06    0.00016266    -0.00025368     0.00028072    2997.6    1.0013
    {'x126'}    -4.1864e-05    3.0352e-06    0.00016512     -0.0003095     0.00023344    2959.6    1.0011
    {'x127'}     0.00033433    2.9998e-06    0.00016052     7.1243e-05     0.00060323    2863.4    1.0013
    {'x128'}     0.00014217    3.0008e-06    0.00016593    -0.00013015     0.00042515    3057.6    1.0018
    {'x129'}     9.5716e-05    2.8679e-06    0.00016026    -0.00016103     0.00035781    3122.7         1
    {'x130'}    -0.00023542    2.7129e-06    0.00016021    -0.00049595     2.6117e-05    3487.7         1
    {'x131'}    -0.00015373    2.9568e-06    0.00015966    -0.00040937     0.00010756    2915.5         1
    {'x132'}    -4.1621e-06    2.9843e-06    0.00016612    -0.00027608     0.00026833    3098.5         1
    {'x133'}    -0.00010851    2.9069e-06    0.00016427    -0.00037817     0.00015383    3193.3         1
    {'x134'}    -0.00011674    3.0453e-06    0.00016433    -0.00039813     0.00015141    2911.8         1
    {'x135'}    -4.1576e-05    2.8478e-06    0.00016167    -0.00030374     0.00022974    3222.9         1
    {'x136'}     -0.0002293    2.9397e-06    0.00016323    -0.00049904     2.8949e-05    3083.1    1.0004
    {'x137'}    -1.9168e-05    2.7385e-06    0.00015826    -0.00027238     0.00024355    3339.7         1
    {'x138'}     0.00011978    3.0067e-06    0.00015825    -0.00013685     0.00038409    2770.1         1
    {'x139'}     0.00011369    2.8644e-06    0.00016456    -0.00016165     0.00039006    3300.8    1.0001
    {'x140'}    -7.8073e-05    2.9246e-06    0.00016404    -0.00034236     0.00019426    3146.1         1
    {'x141'}     3.7089e-05    2.9745e-06    0.00016583    -0.00023891      0.0003062    3108.2         1
    {'x142'}     -0.0001227    2.9737e-06    0.00016517    -0.00038961     0.00014794    3085.2         1
    {'x143'}    -0.00011808    2.8674e-06    0.00015821    -0.00037488     0.00015186    3044.4         1
    {'x144'}     1.4944e-05    3.0581e-06    0.00016782    -0.00025136     0.00028139    3011.3    1.0005
    {'x145'}    -3.8168e-06    2.9241e-06    0.00016075    -0.00025666     0.00025522    3022.2         1
    {'x146'}    -3.9767e-05    2.8077e-06    0.00015522    -0.00029114     0.00022191    3056.3    1.0005
    {'x147'}    -5.7697e-05    2.8882e-06    0.00015635    -0.00030531     0.00020164    2930.4         1
    {'x148'}      0.0001062     2.911e-06    0.00016046    -0.00015277     0.00036568    3038.3     1.001
    {'x149'}     -0.0003317     2.903e-06     0.0001594    -0.00058983    -7.2674e-05      3015         1
    {'x150'}    -0.00021307    2.8972e-06    0.00015984    -0.00047853     4.6515e-05      3044         1
    {'x151'}    -0.00022186    2.7982e-06    0.00015552    -0.00048067     3.9352e-05    3089.2    1.0009
    {'x152'}    -2.2826e-05    2.7361e-06    0.00015515    -0.00027444     0.00023577    3215.4         1
    {'x153'}     1.8636e-05    2.9192e-06    0.00015379    -0.00023285     0.00027348    2775.3         1
    {'x154'}     7.5589e-05    2.9772e-06    0.00016451    -0.00019076     0.00035386    3053.5    1.0003
    {'x155'}     0.00023128    3.0416e-06       0.00016    -3.8633e-05     0.00049476      2767    1.0015
    {'x156'}     4.4582e-06    2.7999e-06    0.00015314    -0.00023941     0.00025585    2991.6    1.0001
    {'x157'}     5.5872e-05     2.687e-06    0.00015776    -0.00020509      0.0003285    3447.1    1.0002
    {'x158'}     0.00030394    2.8717e-06    0.00015543     5.4935e-05     0.00056316    2929.3         1
    {'x159'}    -6.3548e-05    2.7692e-06    0.00015522    -0.00031939     0.00019126    3141.9    1.0009
    {'x160'}    -2.6607e-05     2.984e-06    0.00015961    -0.00028869     0.00023435      2861         1
    {'x161'}    -2.8916e-05    2.7909e-06    0.00016256    -0.00029804     0.00023042    3392.6         1
    {'x162'}     0.00010306    2.9082e-06    0.00016021    -0.00016608     0.00036908    3034.8    1.0016
    {'x163'}    -0.00018927    2.8786e-06    0.00015479     -0.0004452     5.4947e-05    2891.5         1
    {'x164'}     3.1847e-05    3.0331e-06    0.00016325     -0.0002332     0.00030234    2896.8     1.001
    {'x165'}     -0.0001521    3.0591e-06     0.0001632    -0.00041907     0.00011601      2846         1
    {'x166'}     5.4205e-06    2.8629e-06    0.00016135    -0.00026091     0.00027442    3176.4    1.0011
    {'x167'}     0.00027559    2.7661e-06    0.00015997     1.6255e-05     0.00054632    3344.7    1.0007
    {'x168'}     0.00010564    2.8761e-06    0.00015478    -0.00015227     0.00035376    2896.2         1
    {'x169'}    -6.7203e-05    2.6281e-06    0.00015349    -0.00032295     0.00018737    3410.8         1
    {'x170'}    -0.00015766    2.7184e-06    0.00015204    -0.00040659     9.2451e-05    3128.2         1
    {'x171'}    -7.0184e-05    2.8383e-06    0.00015732    -0.00032568      0.0001905    3072.4         1
    {'x172'}     8.1828e-05    2.9976e-06     0.0001622    -0.00018767     0.00035126      2928         1
    {'x173'}    -0.00010564    2.7037e-06    0.00015358    -0.00036035     0.00014744    3226.5    1.0009
    {'x174'}     3.3661e-05    2.6936e-06    0.00015831    -0.00022369     0.00028882    3454.4    1.0005
    {'x175'}    -0.00029766    2.7936e-06    0.00015522    -0.00054847    -4.7733e-05      3087    1.0004
    {'x176'}     0.00014492    2.9656e-06    0.00016135     -0.0001206     0.00040856    2960.1    1.0002
    {'x177'}     4.1862e-05    2.8364e-06    0.00016042    -0.00022784     0.00030689    3198.7    1.0001
    {'x178'}      5.704e-05     3.044e-06    0.00015884    -0.00020545     0.00031993    2722.8         1
    {'x179'}    -7.6095e-05    2.7472e-06    0.00015449    -0.00033248     0.00018094    3162.2    1.0005
    {'x180'}     0.00021748    2.9314e-06    0.00016501    -4.6598e-05     0.00048627    3168.8         1
    {'x181'}    -0.00014338    2.8539e-06    0.00015623    -0.00039869      0.0001191    2996.7         1
    {'x182'}    -0.00014537    2.7598e-06    0.00015672    -0.00039833     0.00011822    3224.9         1
    {'x183'}    -7.7885e-05    2.7672e-06    0.00015804    -0.00034187     0.00018313    3261.8         1
    {'x184'}    -0.00046292    2.7015e-06    0.00015438    -0.00071055    -0.00021053    3265.8         1
    {'x185'}     2.1885e-05    2.8626e-06    0.00015596     -0.0002252     0.00027939    2968.2    1.0002
    {'x186'}     0.00020299    2.7638e-06    0.00016102    -6.1549e-05     0.00046863    3394.3         1
    {'x187'}    -0.00013708    3.1456e-06    0.00015948    -0.00039654     0.00011769    2570.5    1.0005
    {'x188'}      6.995e-05    2.8545e-06    0.00016164    -0.00019088     0.00033995    3206.4         1
    {'x189'}     5.8643e-05    2.7729e-06    0.00015567    -0.00019998     0.00031881    3151.7         1
    {'x190'}    -7.9619e-05    2.9265e-06    0.00015918     -0.0003373     0.00018051    2958.5    1.0005
    {'x191'}     2.3462e-05    3.0613e-06    0.00016954      -0.000255     0.00030322    3067.3    1.0005
    {'x192'}    -0.00017035    2.8644e-06    0.00016274    -0.00043136     0.00010127    3227.9    1.0012
    {'x193'}     0.00013392    2.9879e-06    0.00016263    -0.00013257     0.00040092    2962.6    1.0004
    {'x194'}     0.00017436    2.8433e-06    0.00015939     -8.774e-05      0.0004364    3142.6         1
    {'x195'}     4.5744e-05    3.0508e-06    0.00016398    -0.00021902     0.00032255    2889.3         1
    {'x196'}    -2.6028e-05    2.9105e-06    0.00015737    -0.00028379     0.00023844    2923.6         1
    {'x197'}     0.00022348    2.8682e-06    0.00016158    -4.3155e-05     0.00049671    3173.7    1.0001
    {'x198'}     8.0144e-05    2.8913e-06    0.00016059    -0.00018373     0.00034263    3085.2         1
    {'x199'}    -0.00016091    2.8131e-06    0.00016144    -0.00042291     0.00010109    3293.3    1.0001
    {'x200'}     5.6395e-05    3.0091e-06    0.00016361    -0.00021017     0.00032688    2956.2         1
    {'x201'}     1.7768e-05    2.9368e-06    0.00016205    -0.00024907     0.00028379    3044.6    1.0004
    {'x202'}     5.6544e-05    2.9107e-06    0.00015933    -0.00020654     0.00032332    2996.6    1.0002
    {'x203'}    -0.00019047    2.9901e-06    0.00016093     -0.0004642     6.8405e-05    2896.5         1
    {'x204'}     6.4307e-05    2.8566e-06    0.00015927    -0.00019408     0.00033031    3108.6    1.0001
    {'x205'}    -9.3953e-05    3.0698e-06    0.00016357    -0.00036223     0.00017829      2839    1.0001
    {'x206'}    -0.00023085    2.9593e-06    0.00015995    -0.00050038     2.3291e-05    2921.5         1
    {'x207'}     0.00010783    3.0211e-06    0.00016543    -0.00016374     0.00036874    2998.3         1
    {'x208'}    -5.4783e-06    2.8687e-06    0.00015628    -0.00026162     0.00025546    2967.7    1.0006
    {'x209'}     0.00024577    3.0032e-06    0.00016313    -2.6625e-05     0.00051073    2950.4    1.0001
    {'x210'}     0.00013561    3.0401e-06    0.00016768     -0.0001401     0.00041646    3042.3    1.0006
    {'x211'}      -3.83e-05    2.9156e-06     0.0001604    -0.00029306     0.00023023    3026.5    1.0008
    {'x212'}    -0.00015929    2.8248e-06    0.00015719    -0.00042204     0.00010027    3096.4    1.0001
    {'x213'}     5.2687e-05    2.8944e-06    0.00016188     -0.0002133     0.00032143    3128.1         1
    {'x214'}     7.1526e-05    3.0342e-06    0.00016674    -0.00020455     0.00035157      3020    1.0002
    {'x215'}    -0.00014347    2.9002e-06    0.00015862    -0.00040512     0.00012407    2991.5         1
    {'x216'}    -0.00020096    3.0168e-06    0.00016115    -0.00046433     6.4979e-05    2853.3         1
    {'x217'}     1.9315e-05    3.1828e-06     0.0001706    -0.00025461     0.00030541    2873.1    1.0003
    {'x218'}     2.6971e-05    2.9622e-06    0.00016582    -0.00024141     0.00029046    3133.7    1.0014
    {'x219'}    -0.00019451    2.8519e-06    0.00015948    -0.00045735     7.0815e-05    3127.1         1
    {'x220'}     0.00025285    2.7366e-06    0.00015758      -8.88e-06     0.00051363    3315.8    1.0008
    {'x221'}    -0.00016936     2.847e-06    0.00016242    -0.00043854     0.00010038    3254.6         1
    {'x222'}     7.0119e-05    2.8562e-06    0.00016094    -0.00019336     0.00033747      3175         1
    {'x223'}     4.7262e-05    2.7573e-06    0.00015593    -0.00021554     0.00030138      3198         1
    {'x224'}    -0.00028609    2.9404e-06     0.0001594    -0.00055287    -2.0761e-05    2938.7    1.0001
    {'x225'}     5.9075e-05    2.9231e-06    0.00016542    -0.00021542     0.00032919    3202.5    1.0006
    {'x226'}    -7.5444e-05    2.9136e-06     0.0001585    -0.00033753     0.00018371    2959.3    1.0006
    {'x227'}    -0.00034142    2.8466e-06     0.0001642    -0.00061889    -7.3665e-05    3327.5         1
    {'x228'}     0.00017008    2.8172e-06    0.00015967    -9.1256e-05     0.00043428    3212.4         1
    {'x229'}     9.5141e-05    2.8248e-06    0.00016013    -0.00016405     0.00035263    3213.2         1
    {'x230'}     0.00025439    3.0944e-06    0.00016787     -1.769e-05     0.00052755    2943.1    1.0009
    {'x231'}      0.0001361    2.8104e-06    0.00015908    -0.00013298     0.00039995    3204.1    1.0005
    {'x232'}     8.7895e-05    2.9384e-06    0.00016411     -0.0001867     0.00036317    3119.1         1
    {'x233'}     0.00014411    2.9051e-06    0.00015932    -0.00012214     0.00039888    3007.6         1
    {'x234'}     0.00020813    2.6927e-06     0.0001564    -5.4623e-05     0.00046544    3373.5    1.0005
    {'x235'}    -8.3885e-05    3.0762e-06    0.00016092    -0.00035496     0.00017186    2736.4         1
    {'x236'}     6.4049e-05    2.7146e-06    0.00015543    -0.00018737     0.00032206    3278.3    1.0004
    {'x237'}    -8.0549e-05    2.8796e-06    0.00015998    -0.00033781     0.00018368    3086.4    1.0006
    {'x238'}     0.00014353    2.9044e-06    0.00016157    -0.00011762     0.00040905    3094.4    1.0012
    {'x239'}    -4.5646e-05    2.9671e-06    0.00015723    -0.00031165        0.00021    2807.9         1
    {'x240'}     0.00014937    2.9561e-06    0.00016365    -0.00012282     0.00041132    3064.7    1.0002
    {'x241'}    -7.4349e-05    2.8896e-06    0.00015845    -0.00034231     0.00018659    3006.7    1.0027
    {'x242'}     0.00043389    2.9322e-06    0.00015537     0.00017642      0.0006886    2807.6    1.0003
    {'x243'}     0.00015812    2.9777e-06    0.00015951    -0.00010257     0.00042624    2869.5     1.001
    {'x244'}    -4.5563e-06    2.6985e-06    0.00015702    -0.00026679     0.00025716    3385.9         1
    {'x245'}    -2.0699e-05    2.9499e-06    0.00016644    -0.00030215      0.0002611    3183.4         1
    {'x246'}     0.00030796    3.0548e-06    0.00016077     4.1966e-05     0.00056992    2769.7         1
    {'x247'}     0.00020633    2.9602e-06    0.00016444    -6.6348e-05     0.00047917    3086.1    1.0006
    {'x248'}    -4.8989e-05    2.8666e-06    0.00016275    -0.00031063     0.00022178    3223.2    1.0009
    {'x249'}     3.2303e-05    2.8831e-06    0.00016024    -0.00023683     0.00029496    3089.2    1.0011
    {'x250'}    -0.00021795    2.9121e-06    0.00016471    -0.00049019     5.7453e-05    3199.1    1.0001
    {'x251'}    -9.1239e-05     2.909e-06    0.00016147    -0.00035537     0.00017405    3081.2         1
    {'x252'}    -3.0295e-05    2.7938e-06     0.0001597    -0.00029395     0.00023977    3267.6    1.0002
    {'x253'}     0.00015802    2.7124e-06    0.00015361    -9.9457e-05     0.00040163      3207         1
    {'x254'}      6.526e-05    2.6475e-06    0.00014986    -0.00017797     0.00031888    3204.1         1
    {'x255'}     0.00039815    2.9674e-06    0.00016175     0.00012719      0.0006764    2971.1         1
    {'x256'}    -0.00019467    2.9476e-06    0.00016244    -0.00045911     6.8034e-05    3037.1         1
    {'x257'}    -0.00011364    2.8518e-06    0.00015614    -0.00037571     0.00013552    2997.7         1
    {'x258'}    -0.00025337    2.7067e-06    0.00015603    -0.00051138      -3.92e-06    3323.2    1.0001
    {'x259'}     3.8699e-05    2.9773e-06    0.00016243    -0.00023193     0.00030196    2976.3    1.0003
    {'x260'}       0.024225    0.00010314     0.0019702       0.020871       0.027452    364.91    1.0019
    {'x261'}      -0.011148    0.00010579     0.0020176      -0.014503     -0.0078183    363.73    1.0017
    {'x262'}       0.020579    0.00010926     0.0020601       0.017227       0.023926    355.53    1.0026
    {'x263'}    -0.00088355     0.0001127     0.0020591     -0.0043537      0.0025311    333.81    1.0016
    {'x264'}        0.03292    0.00010944     0.0019964       0.029673       0.036143    332.73    1.0023
    {'x265'}       0.025192    0.00011345     0.0020666       0.021819       0.028536    331.83     1.003
    {'x266'}      -0.075885    0.00010781     0.0020694      -0.079233      -0.072488    368.45    1.0028
    {'x267'}      -0.030112    0.00011659      0.002054      -0.033564      -0.026822    310.37    1.0029
    {'x268'}      -0.066155    0.00010519     0.0020715      -0.069548      -0.062849     387.8    1.0018
    {'x269'}     0.00052825    6.4825e-06     0.0001468     0.00029436      0.0007689    512.82    1.0011
    {'x270'}      -0.011334    6.3275e-06    0.00014424      -0.011564      -0.011085    519.62    1.0015
    {'x271'}    -0.00040194    6.6586e-06     0.0001444    -0.00063994    -0.00016272    470.31    1.0012
    {'x272'}      0.0052108    6.3508e-06    0.00014113      0.0049854      0.0054462    493.85    1.0015
    {'x273'}      0.0023035    6.4379e-06    0.00014031      0.0020684      0.0025323       475    1.0027
    {'x274'}      0.0070604     6.664e-06    0.00014447      0.0068307      0.0073025    469.98    1.0018
    {'x275'}    -0.00011229    7.1001e-06    0.00015148    -0.00035988     0.00014069    455.16    1.0012
    {'x276'}     -0.0024928    6.5024e-06    0.00014066     -0.0027186     -0.0022543    467.94    1.0024
    {'x277'}     -0.0092144    6.5267e-06    0.00014507     -0.0094469     -0.0089781    494.04     1.003

Parameter                 True    &lt;exp(logv)&gt;    exp(&lt;logv&gt;)
sigma_alpha         5.0000e-04     5.0334e-04     5.0322e-04
sigma_beta          5.0000e-03     4.8234e-03     4.7736e-03
sigma_tau           2.5000e-04     2.3124e-04     2.2090e-04
</pre><h2 id="10">Visualize samples</h2><pre class="codeinput">figure;
plot(chains{1}(:,1))
title(<span class="string">"log(\sigma_{\alpha}^2), Chain 1"</span>)

figure;
plot(chains{1}(:,2))
title(<span class="string">"log(\sigma_{\beta}^2), Chain 1"</span>)

figure;
plot(chains{1}(:,3))
title(<span class="string">"log(\sigma_{\tau}^2), Chain 1"</span>)

figure(<span class="string">'Name'</span>,<span class="string">'sigma-squared (alpha)'</span>);
histogram(exp(concatenatedSamples(:,1)))
xline(sigma_alpha^2,<span class="string">'r-'</span>,<span class="string">'LineWidth'</span>,1)
xline(mean(exp(concatenatedSamples(:,1))),<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1)
xlabel(<span class="string">"\sigma_\alpha^2"</span>)
ylabel(<span class="string">"Frequency"</span>)

figure(<span class="string">'Name'</span>,<span class="string">'sigma-squared (beta)'</span>);
histogram(exp(concatenatedSamples(:,2)))
xline(sigma_beta^2,<span class="string">'r-'</span>,<span class="string">'LineWidth'</span>,1)
xline(mean(exp(concatenatedSamples(:,2))),<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1)
xlabel(<span class="string">"\sigma_\beta^2"</span>)
ylabel(<span class="string">"Frequency"</span>)

figure(<span class="string">'Name'</span>,<span class="string">'sigma-squared (tau)'</span>);
histogram(exp(concatenatedSamples(:,3)))
xline(sigma_tau^2,<span class="string">'r-'</span>,<span class="string">'LineWidth'</span>,1)
xline(mean(exp(concatenatedSamples(:,3))),<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1)
xlabel(<span class="string">"\sigma_\tau^2"</span>)
ylabel(<span class="string">"Frequency"</span>)

figure(<span class="string">'Name'</span>,<span class="string">'logA'</span>);
ax = gobjects(M-1,1);
<span class="keyword">for</span> i = 1:M-1
    ax(i) = subplot(3,3,i);
    histogram(concatenatedSamples(:,3+N+i))
    xline(log(A(i+1)),<span class="string">'r-'</span>,<span class="string">'LineWidth'</span>,1)
    xline(mean(concatenatedSamples(:,3+N+i)),<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1)
    xlim(log(A(i+1))+[-.01 .01]);
    <span class="keyword">if</span> i == 8
        ax(i).XTick = log(A(i+1))+[-.01 0 .01];
        ax(i).XTickLabel = {<span class="string">'-0.001'</span>, <span class="string">'0'</span>, <span class="string">'0.001'</span>};
        xlabel(ax(i),<span class="string">'Difference from true log(A_k)'</span>);
    <span class="keyword">else</span>
        ax(i).XTickLabel = {};
    <span class="keyword">end</span>
    ax(i).YTickLabel = {};
    <span class="keyword">if</span> i==2
        title(<span class="string">"log(A_k)"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>

figure(<span class="string">'Name'</span>,<span class="string">'eta'</span>);
ax = gobjects(M-1,1);
<span class="keyword">for</span> i = 1:M-1
    ax(i) = subplot(3,3,i);
    histogram(concatenatedSamples(:,3+N+M-1+i))
    xline(eta(i+1),<span class="string">'r-'</span>,<span class="string">'LineWidth'</span>,1)
    xline(mean(concatenatedSamples(:,3+N+M-1+i)),<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1)
    xlim(eta(i+1)+[-.001 .001]);
    <span class="keyword">if</span> i == 8
        ax(i).XTick = eta(i+1)+[-.001 0 .001];
        ax(i).XTickLabel = {<span class="string">'-0.001'</span>, <span class="string">'0'</span>, <span class="string">'0.001'</span>};
        xlabel(ax(i),<span class="string">'Difference from true \eta_k'</span>);
    <span class="keyword">else</span>
        ax(i).XTickLabel = {};
    <span class="keyword">end</span>
    ax(i).YTickLabel = {};
    <span class="keyword">if</span> i==2
        title(<span class="string">"\eta_k"</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="tdhmcnoisetest_03.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_04.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_05.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_06.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_07.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_08.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_09.png" alt=""> <img vspace="5" hspace="5" src="tdhmcnoisetest_10.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Test HMC integration over nuisance parameters to obtain noise parameters

%% Set initial parameters

T=.05;          % sampling time [ps]
N=256;          % number of sampled points
M=10;           % number of traces to compare
SNR=2e3;        % signal to noise ratio
w=0.2;          % pulse width [ps]
tc=N*T/3;       % pulse center [ps]
nMC = pow2(10); % number of Monte Carlo runs

% Generate ideal time-domain pulse and pulse derivative
t=T*(0:N-1);
t=t(:);

xfun = @(t,t0,w) (1-2*((t-t0)/w).^2).*exp(-((t-t0)/w).^2);

%% Simulate data

Noise.add = 1/SNR;
Noise.mult = 10/SNR;
Noise.time = 10*T/SNR;
sigma_alpha = Noise.add;
sigma_beta = Noise.mult;
sigma_tau = Noise.time;

rng('default')
epsilon_alpha = sigma_alpha*randn(N,M);
epsilon_beta = sigma_beta*randn(N,M);
epsilon_tau = sigma_tau*randn(N,M);

sigma_A = 0.05;
sigma_eta = 0.1*T;

x = zeros(N,M);
A = 1 + [0; sigma_A*randn(M-1,1)];
eta = [0; sigma_eta*randn(M-1,1)];
for jj = 1:M
    x(:,jj) = A(jj)...
        *xfun(t, tc + epsilon_tau(:,jj) + eta(jj), w);
end
xn = x + epsilon_alpha + epsilon_beta.*abs(x);

%% Define prior distribution
LogVAlphaPriorMean = -15;
LogVAlphaPriorSigma = 15;
LogVBetaPriorMean = -15;
LogVBetaPriorSigma = 15;
LogVTauPriorMean = -15;
LogVTauPriorSigma = 15;
MuPriorMean = mean(xn, 2);
MuPriorSigma = 10*std(xn, 0, 2);
LogAPriorMean = zeros(M-1,1);
LogAPriorSigma = 5*ones(M-1,1);
EtaPriorMean = zeros(M-1,1);
EtaPriorSigma = 5*T*ones(M-1,1);

%% Define log posterior
logpdf = @(P) tdlogposterior(P, xn, T, ...
    LogVAlphaPriorMean, LogVAlphaPriorSigma, ...
    LogVBetaPriorMean, LogVBetaPriorSigma, ...
    LogVTauPriorMean, LogVTauPriorSigma, ...
    MuPriorMean, MuPriorSigma, ...
    LogAPriorMean, LogAPriorSigma, ...
    EtaPriorMean, EtaPriorSigma);

%% Create HMC sampler

startpoint = [2*log([sigma_alpha; sigma_beta; sigma_tau]); ...
    xfun(t, tc, w); log(A(2:end)); eta(2:end)];
smp = hmcSampler(logpdf, startpoint, 'CheckGradient', false);

%% Estimate MAP point

[MAPpars,fitInfo] = estimateMAP(smp,...
    'VerbosityLevel', 0, ...
    'IterationLimit', 200000);
MAPlogVarAlpha = MAPpars(1);
MAPlogVarBeta = MAPpars(2);
MAPlogVarTau = MAPpars(3);
MAPmu = MAPpars(3 + (1:N));
MAPlogA = MAPpars(3 + N + (1:M-1));
MAPeta = MAPpars(3 + N + M - 1 + (1:M-1));

plot(fitInfo.Iteration,fitInfo.Objective,'ro-');
xlabel('Iteration');
ylabel('Negative log density');

%% Tune sampler

[smp,tuneinfo] = tuneSampler(smp, ...
    'Start', MAPpars, ...
    'MassVectorTuningMethod', 'hessian', ...
    'VerbosityLevel', 1, ...
    'NumPrint', 10);

disp(smp)
disp('')

figure;
plot(tuneinfo.StepSizeTuningInfo.StepSizeProfile);
xlabel('Iteration');
ylabel('Step size');

fprintf("accratio = %.4f\n", tuneinfo.StepSizeTuningInfo.AcceptanceRatio)

%% Draw samples

NumChains = 4;
chains = cell(NumChains,1);
Burnin = 500;
NumSamples = 1000;
ThinSize = 1;
for c = 1:NumChains
    if (c == 1)
        level = 1;
    else
        level = 0;
    end
    chains{c} = drawSamples(smp, ...
        'Start', MAPpars, ...
        'Burnin', Burnin, ...
        'NumSamples', NumSamples, ...
        'ThinSize', ThinSize, ...
        'VerbosityLevel', level, ...
        'NumPrint', 100);
end

%% Examine convergence diagnostics

diags = diagnostics(smp,chains);
disp(diags)

concatenatedSamples = vertcat(chains{:});
true_sigma = [sigma_alpha, sigma_beta, sigma_tau];
mean_exp = sqrt(mean(exp(concatenatedSamples(:,1:3))));
exp_mean = sqrt(exp(mean(concatenatedSamples(:,1:3))));
sigmaEst = [true_sigma; mean_exp; exp_mean]';

fprintf("%-15s%15s%15s%15s\n", "Parameter", "True", "<exp(logv)>", "exp(<logv>)")
fprintf("%-15s%15.4e%15.4e%15.4e\n", "sigma_alpha", sigmaEst(1,:))
fprintf("%-15s%15.4e%15.4e%15.4e\n", "sigma_beta", sigmaEst(2,:))
fprintf("%-15s%15.4e%15.4e%15.4e\n", "sigma_tau", sigmaEst(3,:))

%% Visualize samples

figure;
plot(chains{1}(:,1))
title("log(\sigma_{\alpha}^2), Chain 1")

figure;
plot(chains{1}(:,2))
title("log(\sigma_{\beta}^2), Chain 1")

figure;
plot(chains{1}(:,3))
title("log(\sigma_{\tau}^2), Chain 1")

figure('Name','sigma-squared (alpha)');
histogram(exp(concatenatedSamples(:,1)))
xline(sigma_alpha^2,'r-','LineWidth',1)
xline(mean(exp(concatenatedSamples(:,1))),'k-','LineWidth',1)
xlabel("\sigma_\alpha^2")
ylabel("Frequency")

figure('Name','sigma-squared (beta)');
histogram(exp(concatenatedSamples(:,2)))
xline(sigma_beta^2,'r-','LineWidth',1)
xline(mean(exp(concatenatedSamples(:,2))),'k-','LineWidth',1)
xlabel("\sigma_\beta^2")
ylabel("Frequency")

figure('Name','sigma-squared (tau)');
histogram(exp(concatenatedSamples(:,3)))
xline(sigma_tau^2,'r-','LineWidth',1)
xline(mean(exp(concatenatedSamples(:,3))),'k-','LineWidth',1)
xlabel("\sigma_\tau^2")
ylabel("Frequency")

figure('Name','logA');
ax = gobjects(M-1,1);
for i = 1:M-1
    ax(i) = subplot(3,3,i);
    histogram(concatenatedSamples(:,3+N+i))
    xline(log(A(i+1)),'r-','LineWidth',1)
    xline(mean(concatenatedSamples(:,3+N+i)),'k-','LineWidth',1)
    xlim(log(A(i+1))+[-.01 .01]);
    if i == 8
        ax(i).XTick = log(A(i+1))+[-.01 0 .01];
        ax(i).XTickLabel = {'-0.001', '0', '0.001'};
        xlabel(ax(i),'Difference from true log(A_k)');
    else
        ax(i).XTickLabel = {};
    end
    ax(i).YTickLabel = {};
    if i==2
        title("log(A_k)")
    end
end

figure('Name','eta');
ax = gobjects(M-1,1);
for i = 1:M-1
    ax(i) = subplot(3,3,i);
    histogram(concatenatedSamples(:,3+N+M-1+i))
    xline(eta(i+1),'r-','LineWidth',1)
    xline(mean(concatenatedSamples(:,3+N+M-1+i)),'k-','LineWidth',1)
    xlim(eta(i+1)+[-.001 .001]);
    if i == 8
        ax(i).XTick = eta(i+1)+[-.001 0 .001];
        ax(i).XTickLabel = {'-0.001', '0', '0.001'};
        xlabel(ax(i),'Difference from true \eta_k');
    else
        ax(i).XTickLabel = {};
    end
    ax(i).YTickLabel = {};
    if i==2
        title("\eta_k")
    end
end
##### SOURCE END #####
--></body></html>